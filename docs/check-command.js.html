<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: check-command.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: check-command.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/**
 * Check Commands
 * functions to handle user commands: 'new-list' or 'add' command with data
 * @module src/check-commands
 */

const events = require('../modules/events.js');
const app = require('./app.js');
const db = require('../modules/database');
const Sound = require('node-aplay');
const music = new Sound('../assets/testingfile.wav');

require('../modules/send-message');
require('./light-listen');

events.on('send-list', handleSend);
events.on('check-command', handleCommand);

/**
 * @function handleCommand checks the user command for a MagPi match
 * @param {array} arr
 * @fires green-flash
 * @fires blue-off
 * @fires send-list
 */
function handleCommand(arr){
  console.log('command: ', arr[1]);
  let sendCheck = arr[1].split(' ')[0].trim();
  if(sendCheck ==='send'){
    let listType = arr[1].split(' ')[1].trim();
    events.emit('green-flash')
    events.emit('blue-off');
    events.emit('send-list', listType);
  }

  if(arr[1].trim() === 'play music') {
    events.emit('play');
    events.emit('green-flash');
  }

    if (arr[1] === 'new list') {
        events.emit('blue-flash');
        events.emit('green-flash');
        events.emit('blue-on');
    }

}


/**
 * @function handleSend retrieves the items requested, calls the format function, and emits the message to be sent
 * @param {str} listType
 * @fires bot-message calls handleMessage in send-message.js
 * @fires green-flash 
 */
function handleSend(listType){
  if(listType === 'all' || listType === 'lists'){
    let listArr = db.getAll();
    console.log(listArr);
    listArr.forEach( list => {
    let requestedItems = db.sendList(list);
    let message = formatString(requestedItems, list);
    events.emit('bot-message', message);
    events.emit('green-flash');
    })        
  }
  else{
    let requestedItems = db.sendList(listType);

    if(requestedItems === null){
        console.error('error');
        events.emit('red-flash');
    }
    else{
        let message = formatString(requestedItems, listType);
        console.log(listType, message);
        events.emit('bot-message', message);
        events.emit('green-flash');
    }
  }
}

/**
 *
 * @function formatString formats a list
 * @param {string} items
 * @param {string} listType
 * @returns {string} a string that formatted to print as a list
 */
function formatString(str, listType){
    let conjunctions = ['add', 'and', ','];
   let strArr = str.split(' ');
   const filteredStr = strArr.filter( item => {
       return !conjunctions.includes(item.trim() );
   });
   filteredStr.unshift(`Your MagPi ${listType} List: \n`);
   let myList = filteredStr.join('\n - ');
   return myList;
}


events.on('play', playMusic);

//play song function
function playMusic() {
    console.log('in play music');
        music.play();
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-src_app.html">src/app</a></li><li><a href="module-src_check-commands.html">src/check-commands</a></li><li><a href="module-src_check-data.html">src/check-data</a></li></ul><h3>Classes</h3><ul><li><a href="module-src_check-data-ListMaker.html">ListMaker</a></li></ul><h3>Global</h3><ul><li><a href="global.html#handleDataemptiesthearrayappropriatlyasusercontinuestogiveinput">handleData empties the array appropriatly as user continues to give input</a></li><li><a href="global.html#listenlistensforuserinputandemits">listen listens for user input and emits</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Thu Jan 24 2019 12:15:53 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
